name: CI

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

env:
  SUB_NAME: test_sub
  TENANT_NAME: test_tenant
  RESOURCE_NAME: virtual_machine
  LOCATION: westus
  ENVIRONMENT: dev
  PROJECT_NAME: training_project
  DEV_SUB_NAME: dev_sub
  DEV_TENANT_NAME: dev_tenant
  BUILD_VERSION: "1.0.0"
  ARTIFACT_NAME: training_app
  DEPLOY_REGION: westus2
  VM_SIZE: Standard_B2s
  OS_TYPE: linux
  COMMIT_AUTHOR: ${{ github.actor }}
  COMMIT_SHA: ${{ github.sha }}
  BRANCH_NAME: ${{ github.ref_name }}
  FILE: ./test.yaml
  FILE2: ./test2.json
  FILE3: ./test3.py

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Show files in workspace
        run: |
          pwd
          ls -la

      - name: Verify files exist
        run: |
          for f in "$FILE" "$FILE2" "$FILE3"; do
            [ -f "$f" ] && echo "✅ Found $f" || (echo "❌ Missing $f" && exit 1)
          done

      - name: Print environment variables
        run: |
          echo "Sub_name: $SUB_NAME"
          echo "Tenant_name: $TENANT_NAME"
          echo "Project_name: $PROJECT_NAME"
          echo "Build_version: $BUILD_VERSION"
          echo "Commit_sha: $COMMIT_SHA"
          echo "Branch_name: $BRANCH_NAME"

      - name: Read file contents
        run: |
          echo "Contents of $FILE1:"
          cat "$FILE"

          echo "Contents of $FILE2:"
          cat "$FILE2"

          echo "Contents of $FILE3:"
          cat "$FILE3"

      - name: Create ZIP file
        run: |
          zip myfiles-${{ github.run_number }}.zip "$FILE" "$FILE2" "$FILE3"

      - name: Upload ZIP as artifact
        uses: actions/upload-artifact@v4
        with:
          name: zipped-build
          path: myfiles-${{ github.run_number }}.zip