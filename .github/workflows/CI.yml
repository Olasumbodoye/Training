name: CI

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

env:
  SUB_NAME: test_sub
  TENANT_NAME: test_tenant
  RESOURCE_NAME: virtual_machine
  LOCATION: westus
  ENVIRONMENT: dev
  PROJECT_NAME: training_project
  DEV_SUB_NAME: dev_sub
  DEV_TENANT_NAME: dev_tenant
  BUILD_VERSION: "1.0.0"
  ARTIFACT_NAME: training_app
  DEPLOY_REGION: westus2
  VM_SIZE: Standard_B2s
  OS_TYPE: linux
  COMMIT_AUTHOR: ${{ github.actor }}
  COMMIT_SHA: ${{ github.sha }}
  BRANCH_NAME: ${{ github.ref_name }}
  FILE: ./test.yaml
  FILE2: ./test2.json
  FILE3: ./test3.py

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: List environment variables
        run: |
          echo "Sub_name: $SUB_NAME"
          echo "Tenant_name: $TENANT_NAME"
          echo "Resource_name: $RESOURCE_NAME"
          echo "Location: $LOCATION"
          echo "Environment: $ENVIRONMENT"
          echo "Project_name: $PROJECT_NAME"
          echo "Dev_sub_name: $DEV_SUB_NAME"
          echo "Dev_tenant_name: $DEV_TENANT_NAME"
          echo "Build_version: $BUILD_VERSION"
          echo "Artifact_name: $ARTIFACT_NAME"
          echo "Deploy_region: $DEPLOY_REGION"
          echo "Vm_size: $VM_SIZE"
          echo "Os_type: $OS_TYPE"
          echo "Commit_author: $COMMIT_AUTHOR"
          echo "Commit_sha: $COMMIT_SHA"
          echo "Branch_name: $BRANCH_NAME"

      - name: Read the contents of my files
        run: |
          cat $FILE
          cat $FILE2
          cat $FILE3

      - name: Create ZIP file
        run: |
          zip myfiles-${{ github.run_number }}.zip $FILE $FILE2 $FILE3

      - name: Upload ZIP as artifact
        uses: actions/upload-artifact@v3
        with:
          name: zipped-build
          path: myfiles-${{ github.run_number }}.zip
